<!DOCTYPE HTML>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>Memory Test</title>
<style>
body {
background-color: black;
}

#history {
color: white;
}

#grid {
display: grid;
grid-template-columns: repeat(7, 70px);
grid-gap: 5px;
}

.cell {
width: 70px;
height: 70px;
background-color: black;
color: white;
display: flex;
justify-content: center;
align-items: center;
font-size: 2.5em;
cursor: pointer;
}

.hidden {
background: white;
color: white;
}

.blank {
background: black;
}

#history {
margin-top: 20px;
}
</style>
</head>
<body>
<div style="color: white">Time recording... <br />To record your best time, please refresh this page first!</div>
<div id="grid"></div>
<div id="history">
<p><strong>Best score:</strong>
<span id="bestTime">--</span> seconds</p>
<p><strong>History:</strong></p>
<ul id="historyList"></ul>
</div>
<script>
const numbers = [...Array(9).keys()].map(i => i + 1);
let gridCells = [...Array(28).keys()];
let timeStart, history = [];
let bestTime = localStorage.getItem("bestTime");
if (bestTime !== null) {
    document.getElementById("bestTime").textContent = bestTime;
}

function createGrid() {
    const grid = document.getElementById('grid');
    grid.innerHTML = '';
    gridCells = gridCells.map(() => {
        const cell = document.createElement('div');
        cell.classList.add('cell');
        grid.appendChild(cell);
        return cell;
    });
    placeNumbers();
}

function placeNumbers() {
    const positions = shuffle([...Array(28).keys()]).slice(0, 9);
    numbers.forEach((number, index) => {
        const cell = gridCells[positions[index]];
        cell.textContent = number;
        cell.onclick = () => selectNumber(number);
        timeStart = performance.now();
    }); 
}

function selectNumber(number) {
    const timeNow = performance.now();
    if (number === 1) {
        document.querySelectorAll('.cell').forEach(cell => {
            if (cell.textContent === "") {
                cell.classList.add('blank');
            } else {
            cell.classList.add('hidden');
            };
        });
    }
    if (number === Math.min(...numbers.filter(n => !history.includes(n)))) {
        history.push(number);
        const cell = gridCells.find(cell => cell.textContent == number);
        cell.classList.remove('hidden');
        if (history.length === numbers.length) {
            const timeTaken = ((timeNow - timeStart) / 1000).toFixed(2);
console.log(timeTaken);
console.log(bestTime);
            alert('Finished! Time usage: ' + timeTaken + ' seconds');
            document.getElementById('historyList').innerHTML += '<li>' + timeTaken + ' seconds';
            if (bestTime === null || timeTaken < bestTime) {
                bestTime = timeTaken;
console.log(timeTaken);
console.log(bestTime);
                localStorage.setItem("bestTime", bestTime);
                document.getElementById('bestTime').textContent = bestTime;
            }
            history = [];
            createGrid();
        }
    } else {
        history = [];
        createGrid();
    }
}

function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

createGrid();
</script>
</body>
</html>